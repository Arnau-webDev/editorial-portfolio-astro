---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import Reveal from '../../components/case-study/Reveal.astro';
import StatCard from '../../components/case-study/StatCard.astro';
import MetricCard from '../../components/case-study/MetricCard.astro';
import SectionHeading from '../../components/case-study/SectionHeading.astro';
import SubHeading from '../../components/case-study/SubHeading.astro';
import DecisionCard from '../../components/case-study/DecisionCard.astro';
---

<BaseLayout
  title="This Portfolio — Why Astro SSG | Arnau Marquilles"
  description="Why Astro SSG is the right tool for a fast, SEO-friendly portfolio — and the Lighthouse scores to prove it."
>
  <Header variant="case-study" />
  <main class="pt-16">

    <!-- HERO -->
    <section class="py-10 px-8 md:px-12 lg:px-20 xl:px-32 2xl:px-40">
      <div class="max-w-[2500px] mx-auto">
        <Reveal instant>
          <p class="text-primary text-base tracking-widest uppercase mb-6">Case Study</p>
          <h1 class="font-serif text-3xl md:text-4xl lg:text-5xl text-foreground mb-6 max-w-[900px] leading-tight">
            Why Astro SSG for this Portfolio
          </h1>
          <p class="text-text-body text-lg max-w-[640px] leading-relaxed mb-12">
            Static content deserves static tooling. A portfolio has no runtime state,
            no user authentication, no real-time data — just pre-written text and images.
            Astro ships zero JavaScript by default, giving you pre-rendered HTML,
            instant loads, and perfect SEO out of the box.
          </p>
        </Reveal>

        <Reveal instant delay={0.15}>
          <div class="flex flex-wrap gap-x-10 gap-y-4 mb-12 pb-12 border-b border-border">
            {[
              { label: 'Role', value: 'Solo Developer' },
              { label: 'Timeline', value: '1 week' },
              { label: 'Type', value: 'Personal Project' },
              { label: 'Stack', value: 'Astro 5 · Tailwind · TypeScript' },
            ].map((item) => (
              <div>
                <p class="text-text-muted text-sm tracking-widest uppercase mb-1">{item.label}</p>
                <p class="text-foreground text-base">{item.value}</p>
              </div>
            ))}
          </div>
        </Reveal>

        <Reveal instant delay={0.3}>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <StatCard value="100" label="Lighthouse Performance" />
            <StatCard value="0 KB" label="React Runtime" />
            <StatCard value="7" label="npm Packages" />
            <StatCard value="0.4s" label="FCP (Time to First Paint)" />
          </div>
        </Reveal>
      </div>
    </section>

    <!-- THE PROBLEM & THE SOLUTION -->
    <section class="py-10 md:py-20 px-8 md:px-12 lg:px-20 xl:px-32 2xl:px-40">
      <div class="max-w-[2500px] mx-auto">
        <Reveal><SectionHeading number="01" title="Problem & Solution" /></Reveal>

        <div class="space-y-16 md:space-y-0 md:grid md:grid-cols-2 md:gap-12 md:items-start">
          <!-- The Problem -->
          <div class="max-w-[600px] md:max-w-none">
            <Reveal><SubHeading title="What the React Version Shipped" /></Reveal>
            <Reveal delay={0.1}>
              <blockquote class="border-l-2 border-accent/40 pl-6 mb-8">
                <p class="text-text-body text-base md:text-lg leading-relaxed italic">
                  The original portfolio was built with React 18 + Vite — a solid
                  stack for an interactive application. But this site is 100% static
                  content with only three interactive elements: scroll reveals,
                  a mobile menu, and a typing effect. React was massive overkill.
                </p>
              </blockquote>
            </Reveal>
            <Reveal delay={0.15}>
              <ul class="space-y-4">
                {[
                  { title: '~350 KB JS', desc: 'React runtime + React Router + all component libraries shipped on every page load' },
                  { title: 'Empty HTML shell', desc: 'The browser downloaded the page, then had to fetch, parse, and execute JS before rendering any content' },
                  { title: '32 npm packages', desc: 'Including react, react-dom, react-router-dom, tech-stack-icons, lucide-react, @radix-ui/*, tailwindcss-animate, and more' },
                  { title: 'Lighthouse Performance: 78', desc: 'FCP of 2.1s, LCP of 2.1s — the browser waits for JS before showing any content' },
                ].map((point) => (
                  <li class="flex gap-3">
                    <span class="text-accent mt-1.5 shrink-0">&mdash;</span>
                    <div>
                      <span class="text-foreground font-medium">{point.title}</span>
                      <span class="text-text-body"> — {point.desc}</span>
                    </div>
                  </li>
                ))}
              </ul>
            </Reveal>
          </div>

          <!-- The Solution -->
          <div class="max-w-[600px] md:max-w-none">
            <Reveal><SubHeading title="The Solution — Astro SSG" /></Reveal>
            <Reveal delay={0.1}>
              <blockquote class="border-l-2 border-accent/40 pl-6 mb-8">
                <p class="text-text-body text-base md:text-lg leading-relaxed italic">
                  Astro's zero-JS-by-default model forced the right question at every
                  component: does this actually need to run in the browser? The answer
                  was almost always no.
                </p>
              </blockquote>
            </Reveal>
            <Reveal delay={0.15}>
              <ul class="space-y-4">
                {[
                  { title: 'Pre-rendered HTML', desc: 'Content is visible immediately — no JS bundle to download, parse, or execute before first paint' },
                  { title: 'Zero runtime by default', desc: 'Astro ships static HTML + CSS. Client-side JS is opt-in at the component level, not the default' },
                  { title: 'Perfect SEO out of the box', desc: 'Search engines get complete HTML — no hydration delay, no empty shells, no rendering budget wasted' },
                  { title: 'Lighthouse Performance: 100', desc: 'FCP of 0.4s, LCP of 0.4s — a 22-point gain from choosing the right abstraction level' },
                ].map((point) => (
                  <li class="flex gap-3">
                    <span class="text-accent mt-1.5 shrink-0">&mdash;</span>
                    <div>
                      <span class="text-foreground font-medium">{point.title}</span>
                      <span class="text-text-body"> — {point.desc}</span>
                    </div>
                  </li>
                ))}
              </ul>
            </Reveal>
          </div>
        </div>
      </div>
    </section>

    <!-- DECISION LOG -->
    <section class="py-10 md:py-20 px-8 md:px-12 lg:px-20 xl:px-32 2xl:px-40">
      <div class="max-w-[2500px] mx-auto">
        <Reveal><SectionHeading number="02" title="Decision Log" /></Reveal>
        <Reveal delay={0.1}>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 md:gap-6">
            <DecisionCard
              title="Framework Choice"
              decision="Astro over Next.js or Remix"
              rationale="Next.js and Remix both default to server-side concerns or React islands. Astro is specifically designed for content-first sites — it ships zero JS by default and lets you opt in to interactivity at the component level. A portfolio with no data fetching and no user state has no business using Next.js."
              tradeoff="Astro is less familiar than Next.js. Acceptable trade-off: the simpler mental model pays back quickly."
            />
            <DecisionCard
              title="Interactivity Strategy"
              decision="Zero React islands — vanilla TypeScript modules"
              rationale="The entire site needed exactly three JS behaviours: scroll reveals (IntersectionObserver), header scroll detection + mobile menu, and a hero typing effect. Each is ~15 lines of vanilla TS. Hydrating a React component for any of these would be grotesque."
              tradeoff="No shared state between interactive elements. Not a problem — these three behaviours are fully independent."
            />
            <DecisionCard
              title="Icon Strategy"
              decision="Inline SVGs instead of tech-stack-icons"
              rationale="tech-stack-icons is a React component library that wraps SVG data. In Astro, SVGs render at build time to static HTML — no runtime cost. By extracting the SVG strings from the package's dist bundle and embedding them in a TypeScript data file, we get identical visuals with zero JS shipped."
              tradeoff="SVG strings make the data file large (~60KB source). Irrelevant — it's build-time data, not shipped JS."
            />
            <DecisionCard
              title="Reveal Animations"
              decision="Single shared IntersectionObserver script"
              rationale="The React version had one useReveal hook per component — 15+ IntersectionObserver instances across the page. The Astro version registers one observer per [data-reveal] element from a single script that runs once on DOMContentLoaded. Simpler, cheaper, and easier to reason about."
              tradeoff="CSS handles the animation state (opacity + transform via .is-visible class). Marginally more verbose HTML, zero runtime overhead."
            />
          </div>
        </Reveal>
      </div>
    </section>

    <!-- ARCHITECTURE COMPARISON -->
    <section class="py-10 md:py-20 px-8 md:px-12 lg:px-20 xl:px-32 2xl:px-40">
      <div class="max-w-[2500px] mx-auto">
        <Reveal><SectionHeading number="03" title="Page Load Flow" /></Reveal>
        <Reveal delay={0.1}>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-bg-elevated border border-destructive/20 rounded-sm p-6 md:p-8">
              <p class="text-destructive text-xs tracking-widest uppercase mb-6">Before — React 18 SPA</p>
              <div class="space-y-3">
                {[
                  { step: '1', label: 'Browser requests /', sub: 'Server responds with empty HTML shell' },
                  { step: '2', label: 'Browser downloads JS bundle', sub: '~350 KB · React runtime + all components' },
                  { step: '3', label: 'JS parses + executes', sub: 'Main thread blocked while bundle is processed' },
                  { step: '4', label: 'React hydrates', sub: 'Builds virtual DOM, reconciles, renders' },
                  { step: '5', label: 'Content visible', sub: 'FCP: 2.1s · user waited over 2 seconds' },
                ].map((item) => (
                  <div class="flex gap-3">
                    <span class="w-6 h-6 rounded-full bg-destructive/10 border border-destructive/30 text-destructive text-xs flex items-center justify-center shrink-0 mt-0.5">{item.step}</span>
                    <div>
                      <p class="text-text-body text-sm font-medium">{item.label}</p>
                      <p class="text-text-muted text-xs">{item.sub}</p>
                    </div>
                  </div>
                ))}
              </div>
            </div>

            <div class="bg-bg-elevated border border-accent/20 rounded-sm p-6 md:p-8">
              <p class="text-accent text-xs tracking-widest uppercase mb-6">After — Astro 5 SSG</p>
              <div class="space-y-3">
                {[
                  { step: '1', label: 'Browser requests /', sub: 'Server responds with complete pre-rendered HTML' },
                  { step: '2', label: 'Browser renders HTML', sub: 'Content visible immediately — FCP: 0.4s' },
                  { step: '3', label: 'CSS loads', sub: 'Tailwind utility classes, no layout shift' },
                  { step: '4', label: 'Small JS modules load', sub: '~4 KB · reveal.ts + header.ts + hero-typing.ts' },
                  { step: '5', label: 'Animations activate', sub: 'IntersectionObserver triggers reveals — TBT: 0ms' },
                ].map((item) => (
                  <div class="flex gap-3">
                    <span class="w-6 h-6 rounded-full bg-accent/10 border border-accent/30 text-accent text-xs flex items-center justify-center shrink-0 mt-0.5">{item.step}</span>
                    <div>
                      <p class="text-text-body text-sm font-medium">{item.label}</p>
                      <p class="text-text-muted text-xs">{item.sub}</p>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        </Reveal>
      </div>
    </section>

    <!-- RESULTS -->
    <section class="py-10 md:py-20 px-8 md:px-12 lg:px-20 xl:px-32 2xl:px-40">
      <div class="max-w-[2500px] mx-auto">
        <Reveal><SectionHeading number="04" title="Results" /></Reveal>
        <Reveal delay={0.1}>
          <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 md:gap-6">
            <MetricCard
              label="Performance"
              value="78 → 100"
              context="22-point gain. Pre-rendered HTML + self-hosted fonts means content is immediately visible — no hydration wait."
            />
            <MetricCard
              label="FCP"
              value="2.1s → 0.4s"
              context="81% faster. The browser gets complete HTML — no JS needed to show content."
            />
            <MetricCard
              label="LCP"
              value="2.1s → 0.4s"
              context="81% faster. The hero text is in the HTML, not injected by React after bundle execution."
            />
            <MetricCard
              label="SEO"
              value="88 → 100"
              context="Slightly better score, different reality. The SPA serves an empty shell — Astro serves complete HTML that search engines can read immediately."
            />
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
            <!-- Baseline -->
            <div class="mt-4">
              <Reveal delay={0.2}>
                <p class="text-text-muted text-xs tracking-widest uppercase mb-4 mt-4">Before — React 18 SPA</p>
              </Reveal>
              <div class="relative">
                <Reveal delay={0.3}>
                  <img
                    src="/images/Lighthouse_metrics_react.png"
                    alt="Lighthouse metrics for the React/Vite version showing FCP 2.1s and LCP 2.1s"
                    class="w-full rounded-sm border border-border"
                  />
                </Reveal>
                <Reveal delay={0.5}>
                  <img
                    src="/images/Lighthouse_score_react.mini.png"
                    alt="Lighthouse performance score of 78 for the React/Vite version"
                    class="absolute -bottom-6 -right-4 w-[35%] max-w-[160px] rounded-xl border border-border shadow-lg"
                  />
                </Reveal>
              </div>
            </div>

            <!-- After -->
            <div class="mt-4">
              <Reveal delay={0.35}>
                <p class="text-text-muted text-xs tracking-widest uppercase mb-4 mt-4">After — Astro SSG</p>
              </Reveal>
              <div class="relative">
                <Reveal delay={0.45}>
                  <img
                    src="/images/Lighthouse_metrics_astro.png"
                    alt="Lighthouse metrics for the Astro SSG version showing FCP 0.4s and LCP 0.4s"
                    class="w-full rounded-sm border border-accent/20"
                  />
                </Reveal>
                <Reveal delay={0.65}>
                  <img
                    src="/images/Lighthouse_score_astro.mini.png"
                    alt="Lighthouse performance score of 100 for the Astro SSG version"
                    class="absolute -bottom-6 -right-4 w-[35%] max-w-[160px] rounded-xl border border-accent/20 shadow-lg"
                  />
                </Reveal>
              </div>
            </div>
          </div>
        </Reveal>
      </div>
    </section>

    <!-- REFLECTION -->
    <section class="py-10 md:py-20 px-8 md:px-12 lg:px-20 xl:px-32 2xl:px-40">
      <div class="max-w-[2500px] mx-auto">
        <Reveal><SectionHeading number="05" title="Reflection" /></Reveal>
        <Reveal delay={0.1}>
          <div class="max-w-[750px]">
            <p class="text-text-body text-base leading-relaxed mb-6">
              React is excellent for applications with complex state, real-time data, and
              rich user interaction. A portfolio with pre-written content, no backend, and
              three CSS-triggerable animations is not that application. Choosing the right
              abstraction level — not the familiar one — is an engineering skill worth
              practising.
            </p>
            <p class="text-text-body text-base leading-relaxed mb-8">
              Astro made the trade-offs explicit. Every component defaults to static HTML;
              adding client-side behaviour is a deliberate opt-in. The result is a lean 7 packages
              only project, zero runtime JS by default, and a set of pre-rendered HTML files
              that load instantly on any connection.
            </p>
            <p class="text-text-body text-lg leading-relaxed italic">
              The migration took one week. The performance improvement was immediate and
              dramatic — proof that choosing the right tool matters more than optimising the wrong one.
            </p>
          </div>
        </Reveal>
      </div>
    </section>

    <div class="py-8"></div>
  </main>
  <Footer />
</BaseLayout>
